# Proyecto_MISP
Este proyecto busca integraR el servidor BIND con la plataforma MISP para automatizar la actualización de las RPZ, con el propósito de bloquear en tiempo real dominios y FQDNs maliciosos, mejorando así la seguridad cibernética y el rendimiento del servicio DNS en micro, pequeñas y medianas empresas.
Aquí tienes el resumen en español, listo para copiar y pegar en tu README de GitHub:

# Servidor DNS BIND9 con RPZ y MISP

Este repositorio describe la configuración de un servidor DNS BIND9 en Ubuntu (versiones 22.04 y 24.04), incluyendo Zonas de Política de Respuesta (RPZ) para bloquear dominios maliciosos, una página de bloqueo personalizada basada en Flask y Nginx para hacer de proxy.

## Tabla de Contenidos

- [Configuración de Ubuntu](#configuración-de-ubuntu)
  - [En la versión 22.04](#en-la-versión-2204)
- [Guest Additions](#guest-additions)
- [BIND9](#bind9)
- [Netplan](#netplan)
- [MISP](#misp)
- [RPZ (Response Policy Zone)](#rpz-response-policy-zone)
- [Extracción desde MISP](#extracción-desde-misp)  

## Configuración de Ubuntu

Para Ubuntu se consideraron dos versiones: 22.04 y 24.04. En ambas versiones se consideró:

* Memoria Base: 6000MB
* 3 procesadores
* Disco de 50GB
* Nombre@nombre_de_la_computadora (formato de nombre de usuario/máquina)



## Guest Additions


<li>sudo apt update</li>
<li>sudo apt install linux-headers-$(uname -r) build-essential dkms</li>
<li>Dispositivos-Incertar CD</li>
<li>clic derecho-abrir en terminal</li>
<li>ls</li>
<li>./autorun.sh</li>
<li>reiniciar</li>

## BIND9
```bash
sudo apt update && sudo apt install bind9 -y
sudo systemctl status bind9
sudo systemctl status ssh
sudo apt-get install openssh-server
cd /etc/bind
sudo vim named.conf.options
sudo apt-get install vim
:wq
sudo named-checkconf
```
## Netplan
```bash
sudo systemctl disable --now systemd-resolved
cd /etc/netplan/
sudo vim 01-network-manager-all.yaml
network:
  version: 2
  ethernets:
    enp0s3:
      addresses:
      - tu ip/24
      nameservers:
        addresses:
        - tu ip  # Apunta a tu servidor BIN
      routes:
      -   to: default
          via: tu default

sudo netplan apply
sudo rm resolv.conf
 /etc/resolv.conf.

nameserver tu ip
```
## MISP
```bash
sudo apt-get update -y && sudo apt-get upgrade -y

sudo apt-get install mysql-client -y

wget https://raw.githubusercontent.com/MISP/MISP/2.4/INSTALL/INSTALL.sh

chmod +x INSTALL.sh

./INSTALL.sh -A

sudo ufw allow 80/tcp

sudo ufw allow 443/tcp
Browse to https://<"your misp instance ip">/users/login
https://192.168.0.164/users/login
Username: admin@admin.test
Password: admin
```
## RPZ
```bash
sudo nano /etc/bind/named.conf.options

options {
        querylog yes;
        directory "/var/cache/bind";
        recursion yes;
        allow-recursion { localhost; tu red; };
        // to talk to, you may need to fix the firewall to allow multipl
        // ports to talk.  See http://www.kb.cert.org/vuls/id/800113

        // If your ISP provided one or more IP addresses for stable
        // nameservers, you probably want to use them as forwarders.
        // Uncomment the following block, and insert the addresses replacing
        // the all-0's placeholder.

        //forwarders {
        //      9.9.9.9;
        //};

        //========================================================================
        // If BIND logs error messages about the root key being expired,
        // you will need to update your keys.  See https://www.isc.org/bind-keys
        //========================================================================
        dnssec-validation auto;

        listen-on { any; };

        response-policy {
                 zone "rpz.local";
        };
};

sudo vim /etc/bind/named.conf.local

zone "rpz.local" {
    type master;
    file "/etc/bind/db.rpz.local";
    allow-query { localhost; };
    allow-transfer { localhost; };
};

sudo cp /etc/bind/db.empty /etc/bind/db.rpz.local
sudo vim /etc/bind/db.rpz.local
; BIND reverse data file for empty rfc1918 zone
;
; DO NOT EDIT THIS FILE - it is used for multiple zones.
; Instead, copy it, edit named.conf, and use that copy.
;
$TTL    86400
@       IN      SOA     localhost. root.localhost. (
                              1         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                          86400 )       ; Negative Cache TTL
;
@       IN      NS      localhost.


sudo vim /etc/bind/named.conf


logging {
    channel rpzlog {
        file "/var/log/named/rpz.log" versions unlimited size 100m;
        print-time yes;
        print-category yes;
        print-severity yes;
        severity info;
    };
    category rpz { rpzlog; };
};




include "/etc/bind/named.conf.options";
include "/etc/bind/named.conf.local";
include "/etc/bind/named.conf.default-zones";

sudo mkdir /var/log/named/
sudo chown bind:bind /var/log/named/ -R

sudo named-checkconf

sudo named-checkzone rpz /etc/bind/db.rpz.local

sudo systemctl restart bind9

sudo nano /etc/default/named
OPTIONS="-u bind -4"


```
## Extracción desde MISP
La carpeta en este repositorio contiene los códigos para una extracción automatica de Indicadores de Compromiso desde MISP, con el objetivo de alimentar la RPZ de BIND de forma automatizada. La carpeta debe ser colocada en la "Carpeta Personal" de la máquina virtual y darle permisos de ejecución. Una vez realizado ello se puede ejecuar el sistema mediante el comando:
```bash
sudo ./opciones.sh
```
